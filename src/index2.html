<!DOCTYPE html>
<html>
    <head>
        <title>Tech Agent</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
        <style>p{margin:0}div{margin-bottom:1em}</style>
    </head>
    <body>
        <div><input type="text" name="message" class="message" placeholder="Введите сообщение"></div>
        <div><button class="send">Отправить</button>
            <button class="clear">Очистить</button></div>
        <div class="messages"></div>
        <script>
            var timerReconnectionWebSocket,
                socket, connected = false,
                textarea_class = "messages",
                input_class = "message";
            
            (function start() {
                socket = new WebSocket("wss://176.9.99.240:9501");

                socket.onopen = function() {
                  connected = true;
                  viewLog('Соединение установлено');
                  clearInterval(timerReconnectionWebSocket);
                };

                socket.onerror = function(error) {
                  connected = false;
                  viewLog('Ошибка: ' + error.message);
                };

                socket.onclose = function(event) {
                  connected = false;
                  timerReconnectionWebSocket = setTimeout(start, 2000);
                  if (event.wasClean) {
                    viewLog('Соединение закрыто чисто, Код: ' + event.code);
                  } else {
                    viewLog('Обрыв соединения, Код: ' + event.code);
                  }
                };

                socket.onmessage = function(event) {
                  viewLog(event.data);
                };
            })();
            
            document.querySelector(".send").addEventListener('click', function() {
              var text = document.querySelector("." + input_class).value;
              
              if (connected) {
                sendMessage(text);
              } else {
                viewLog('Соединение еще не установлено');
              }
            });
            
            document.querySelector(".clear").addEventListener('click', function() {
              document.querySelector("." + textarea_class).innerHTML = '';
            });
            
            function sendMessage(text) {
              viewLog('Отправляем текст:' + text);
              socket.send(text);
            }
            
            function viewLog(text) {              
              document.querySelector("." + textarea_class).innerHTML += '<p>' + text + '</p>';
            }

        </script>
    </body>
</html>
