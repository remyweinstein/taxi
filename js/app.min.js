function init(){if($.get("https://"+server_uri+"/profile?token="+my_token,function(e){e.ok||"#pages__sms"===lasturl?(my_phone=e.profile.phone,my_name=e.profile.name,my_city=e.profile.city,$(".jq_my_name").length&&($(".jq_my_name").html(my_name),$(".jq_my_phone").html(my_phone))):(is_auth=!1,my_token="",localStorage.removeItem("_is_auth"),localStorage.removeItem("_my_token"))},"json"),$(".jq_form-edit-auto").length&&$.get("https://"+server_uri+"/profile?token="+my_token,function(e){$('input[name="color"]').val(e.profile.color),$('input[name="number"]').val(e.profile.number),$('input[name="model"]').val(e.profile.model),$('input[name="tonnage"]').val(e.profile.tonnage);var t=$('select[name="brand"] option[value="'+e.profile.brand+'"]');t.attr("selected","true")},"json"),$(".jq_form-edit-auto-cog").length&&$.get("https://"+server_uri+"/auto?token="+my_token,function(e){var t=$(e.auto.conditioner?'input[name="conditioner"][value="1"]':'input[name="conditioner"][value="0"]');t.attr("checked","checked");var o=$('select[name="type"] option[value="'+e.auto.type+'"]');o.attr("selected","true")},"json"),$(".jq_form-edit-profile").length&&$.get("https://"+server_uri+"/profile?token="+my_token,function(e){$('input[name="name"]').val(e.profile.name),$('input[name="dob"]').val(dateFromBase(e.profile.birthday));var t=$(e.profile.sex?'select[name="sex"] option[value="1"]':'select[name="sex"] option[value="0"]');t.attr("selected","true");var o=$('select[name="city"] option[value="'+e.profile.city+'"]');o.attr("selected","true")},"json"),$(".content").css("height",$(window).outerHeight()-$(".header").outerHeight()),tabs=$(".tabs ul li"),tabs.length){var e=tabs.length;tabs.css("width",100/e-1+"%"),$(".tabs__viewport").css("width",e*$(window).width()+"px"),$(".tabs_content").css("width",$(window).width()),new Hammer($(".tabs__wrapper")[0],{domEvents:!0})}$(".form-order-city").length&&($('input[name="from"]').val(localStorage.getItem("_address_from")),$('input[name="to"]').val(localStorage.getItem("_address_to"))),$("#map_canvas_choice").length&&initialize_choice(),$("#map_canvas").length&&initialize(),$(".tabs_content").on("swipeleft",function(){swipeTabs(1)}),$(".tabs_content").on("swiperight",function(){swipeTabs(-1)})}function geoFindMe(){function e(e){var t=e.coords.latitude,o=e.coords.longitude;my_position.x=t,my_position.y=o,geocoder=new google.maps.Geocoder;var n=new google.maps.LatLng(t,o);geocoder.geocode({latLng:n},function(e,t){if(t===google.maps.GeocoderStatus.OK){var o,n=e[0].address_components;for(o in n)"locality"===n[o].types[0]&&""!==my_city&&(my_city=n[o].long_name),"country"===n[o].types[0]&&(my_coutry=n[o].long_name)}})}function t(){alert("На вашем устройстве не разрешен доступ к местоположению.")}return navigator.geolocation?void navigator.geolocation.getCurrentPosition(e,t):void alert("К сожалению, геолокация не поддерживается в вашем браузере")}function searchCityForIntercity(e,t){var o;t.children().children(".list-extended li").each(function(t,n){o=$(n).children(".list-extended__route").children(".list-extended__route_to").text(),o===e||""===e?$(n).css("display","flex"):$(n).css("display","none")})}function swipeMenu(e){$(".menu").animate({left:e+"=80%"},250)}function swipeTabs(e){var t=$(".tab--active").data("tab");t+e<tabs.length+1&&t+e>0&&changeTab(t+e)}function changeTab(e){step=$(window).width(),$(".tabs_content").css("left",step-step*e+"px"),tabs.removeClass("tab--active"),$('*[data-tab="'+e+'"]').addClass("tab--active")}function checkURL(e){e||(e=window.location.hash?window.location.hash:"#driver__city"),e!==lasturl&&(lasturl=e,loadPage(e))}function loadPage(e){is_auth||"#pages__sms"===e||(e="#pages__login",document.location=e),e=e.replace("#","");var t=e.split("__");$(".loading").css("visibility","visible"),$.ajax({dataType:"json",url:"routes.php",type:"POST",data:{section:t[0],page:t[1]},success:function(e){0!==parseInt(e)&&($(".header__title").html(e.title),$(".content").html(e.content),(t[0]!==lastsection||""===lastsection)&&$(".menu__response").html(e[0].menu),lastsection=t[0],$(".loading").css("visibility","hidden"),init())}})}function initialize(){var e=new google.maps.LatLng(48.49,135.07),t=document.getElementById("map_canvas"),o={center:e,zoom:12,mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(t,o),directionsService=new google.maps.DirectionsService;var n=loadAddress();requestDirections(n[0],n[1],{strokeColor:"#ff0000"})}function initialize_choice(){if(o=18,void 0===my_position.x||void 0===my_position.y)var e=48.4,t=135.07,o=12;else var e=my_position.x,t=my_position.y;var n=new google.maps.LatLng(e,t),i=document.getElementById("map_canvas_choice"),a={center:n,zoom:o,mapTypeId:google.maps.MapTypeId.ROADMAP};map_choice=new google.maps.Map(i,a);var r=$("<div/>").addClass("centerMarker").appendTo(map_choice.getDiv());google.maps.event.addListener(map_choice,"drag",function(){var e=point2LatLng(r[0].offsetLeft,r[0].offsetTop,map_choice);localStorage.setItem("_choice_coords",e)})}function renderDirections(e,t){var o=new google.maps.DirectionsRenderer;o.setMap(map),t&&o.setOptions({polylineOptions:t}),o.setDirections(e)}function requestDirections(e,t,o){directionsService.route({origin:e,destination:t,travelMode:google.maps.DirectionsTravelMode.DRIVING},function(e){renderDirections(e,o)})}function getChar(e){return null===e.which?e.keyCode<32?null:String.fromCharCode(e.keyCode):0!==e.which&&0!==e.charCode?e.which<32?null:String.fromCharCode(e.which):null}function setTempRequestLS(e){return localStorage.setItem("_temp_request",e),!0}function getTempRequestLS(){var e=localStorage.getItem("_temp_request");return localStorage.removeItem("_temp_request"),e}function saveAddress(e,t){return localStorage.setItem("_address_from",e),localStorage.setItem("_address_to",t),!0}function loadAddress(){var e=my_city+","+localStorage.getItem("_address_from"),t=my_city+","+localStorage.getItem("_address_to");return[e,t]}function point2LatLng(e,t,o){var n=o.getProjection().fromLatLngToPoint(o.getBounds().getNorthEast()),i=o.getProjection().fromLatLngToPoint(o.getBounds().getSouthWest()),a=Math.pow(2,o.getZoom()),r=new google.maps.Point(e/a+i.x,t/a+n.y);return o.getProjection().fromPointToLatLng(r)}function getStreenFromGoogle(e){var t,o,n=e[0].address_components;for(t in n)"street_number"===n[t].types[0]&&(o=n[t].long_name),"route"===n[t].types[0]&&(o=n[t].long_name+","+o);return o}function dateFromBase(e){return"0000-00-00"===e?e="":(e=e.split("-"),e=e[2]+"."+e[1]+"."+e[0]),e}function dateToBase(e){return e=e.split("."),e=e[2]+"-"+e[1]+"-"+e[0]}var tabs,lasturl="",lastsection="",map,map_choice,marker,geocoder,google,placeSearch,autocomplete,directionsService,my_position=["x","y"],server_uri="192.168.20.90",my_city,my_country,my_token,is_auth=!1,my_name,my_phone,my_avatar;$(document).ready(function(){"true"===localStorage.getItem("_is_auth")&&(is_auth=!0),my_token=localStorage.getItem("_my_token"),geoFindMe(),new Hammer($(".menu")[0],{domEvents:!0}),$(".menu").on("swipeleft",function(){swipeMenu("-")}),$(".menu").on("click",".menu__list li",function(){$(".menu__list li").removeClass("menu__list--active"),$(this).addClass("menu__list--active"),swipeMenu("-")}),$("body").on("click",".header__burger",function(){swipeMenu("+")}),$(".content").on("click",".tabs ul li",function(){changeTab($(this).data("tab"))}),$(".content").on("click",".jq_choice_location",function(){document.location="#client__choice_location_map",setTempRequestLS($(this).parent("div").children("span").children("input").attr("name"))}),$(".content").on("click",".form-order-city__field_add",function(){$(".order-city-from:last").after('<div class="form-order-city__field order-city-from"><i class="icon-record form-order-city__label"></i><span class="form-order-city__wrap"><input type="text" name="from_plus[]" value="" placeholder="Заезд"/></span><span class="form-order-city__field_delete"><i class="icon-trash"></i></span></div>'),$(".form-order-city__field_delete").click(function(){$(this).parent("div.order-city-from").remove()})}),$(".content").on("submit",".form-order-city",function(){return saveAddress($(".adress_from").val(),$(".adress_to").val()),document.location="#client__map",!1}),$(".content").on("submit",".jq_form-auth",function(){var e=$.post("https://"+server_uri+"/register?phone=7"+$('input[name="phone"]').val(),function(){},"json");return e.done(function(e){e.ok&&(localStorage.setItem("_my_token",e.token),my_token=e.token,document.location="#pages__sms")},"json"),!1}),$(".content").on("submit",".jq_form-auth-sms",function(){var e=$.post("https://"+server_uri+"/confirm?token="+my_token+"&smsCode="+$('input[name="sms"]').val(),function(){},"json");return e.done(function(e){e.ok&&(localStorage.setItem("_is_auth","true"),document.location="/")},"json"),!1}),$(".content").on("submit",".jq_form-edit-profile",function(){var e=$.post("https://"+server_uri+"/profile?token="+my_token,{photo:$("input[name=ava_file]").prop("files")[0],name:$("input[name=name]").val(),birthday:dateToBase($("input[name=dob]").val()),city:$("select[name=city]").val(),sex:$("select[name=sex]").val()},function(){},"json");return e.done(function(e){console.log(e.ok),console.log(e),e.ok&&(document.location="/")},"json"),!1}),$("body").on("click",".menu__desc",function(){swipeMenu("-"),document.location="#pages__edit_profile"}),$(".content").on("submit",".jq_form-edit-auto",function(){var e=$.post("https://"+server_uri+"/profile?token="+my_token,{color:$('input[name="color"]').val(),number:$('input[name="number"]').val(),model:$('input[name="model"]').val(),tonnage:$('input[name="tonnage"]').val(),brand:$('select[name="brand"] option:selected').text()},function(){},"json");return e.done(function(e){e.ok&&(document.location="/")},"json"),!1}),$(".content").on("submit",".jq_form-edit-auto-cog",function(){var e=$.post("https://"+server_uri+"/auto?token="+my_token,{conditioner:$('input[name="conditioner"]:checked').val(),type:$('select[name="type"] option:selected').val()},function(){},"json");return e.done(function(e){e.ok&&(document.location="/")},"json"),!1}),$("body").on("click",".menu__desc",function(){swipeMenu("-"),document.location="#pages__edit_profile"}),$(".content").on("click",".jq_location_choice",function(){document.location="#client__city";var e=getTempRequestLS();geocoder=new google.maps.Geocoder;var t=localStorage.getItem("_choice_coords");t=t.replace("(",""),t=t.replace(")",""),t=t.replace(" ",""),t=t.split(",");var o=new google.maps.LatLng(t[0],t[1]);geocoder.geocode({latLng:o},function(t,o){o===google.maps.GeocoderStatus.OK&&(localStorage.setItem("_address_"+e,getStreenFromGoogle(t)),$('input[name="from"]').val(localStorage.getItem("_address_from")),$('input[name="to"]').val(localStorage.getItem("_address_to")))})}),$(".content").on("keypress",".input_only_digits",function(e){if(e=e||event,!(e.ctrlKey||e.altKey||e.metaKey)){var t=getChar(e);if(null!==t)return"0">t||t>"9"?!1:void 0}}),$(".content").on("keypress",".input_only_date",function(e){var t=$(this).val();if(t.length>9)return!1;if(e=e||event,!(e.ctrlKey||e.altKey||e.metaKey)){var o=getChar(e);if(0===t.length&&o>"3"||(3===t.length||2===t.length)&&o>"1"||(5===t.length||4===t.length)&&o>"2")return!1;if((2===t.length||5===t.length)&&$(this).val($(this).val()+"."),null!==o)return"0">o||o>"9"?!1:void 0}}),$(".content").on("keyup",".filter_intercity_to",function(){searchCityForIntercity($(this).val(),$(this).parent().parent().parent(".tabs_content"))}),$(window).resize(function(){init()}),checkURL(),setInterval("checkURL()",250),init()});